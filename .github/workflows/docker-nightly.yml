name: php-nightly

on:
  push:
    branches:
      - master
  schedule:
    - cron:  '0 0 * * *'
jobs:
  php-master:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        repository: php/php-src
        ref: master
    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(date +'%Y%m%d')"
    - uses: docker/build-push-action@v1
      with:
        username: ${{ github.repository_owner }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
        repository: "phpsrc/php-nightly-master"
        dockerfile: .github/Dockerfile.debian
        tags: "latest,${{ steps.date.outputs.date }}"
        tag_with_sha: true

  php-74:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        repository: php/php-src
        ref: PHP-7.4
    - name: Get current date
      id: date
      run: echo "::set-output name=date::$(date +'%Y%m%d')"
    - uses: docker/build-push-action@v1
      with:
        username: ${{ github.repository_owner }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
        repository: "phpsrc/php-nightly-7.4"
        dockerfile: .github/Dockerfile.debian
        tags: "latest,${{ steps.date.outputs.date }}"
        tag_with_sha: true
